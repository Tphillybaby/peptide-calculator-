import{r as m,g as E,h as T,i as O,s as L,k as $,l as D,j as e,m as I,n as B,o as G,p as H}from"./vendor-DeVHeJzg.js";import{a as P,s as v}from"./index-BEdA13Re.js";import{w as F,x as z,P as q,g as A,y as R,d as W}from"./icons-CGAKu2bT.js";const w="peptide_tracker_schedule",J=()=>{const[i,h]=m.useState([]),[y,g]=m.useState(!0),{user:l}=P();m.useEffect(()=>{l?p():_()},[l]);const _=()=>{try{const a=localStorage.getItem(w);a&&h(JSON.parse(a))}catch(a){console.error("Error loading from localStorage:",a)}g(!1)},u=a=>{try{localStorage.setItem(w,JSON.stringify(a))}catch(n){console.error("Error saving to localStorage:",n)}},p=async()=>{try{g(!0);const{data:a,error:n}=await v.from("schedules").select("*").order("scheduled_date",{ascending:!0});if(n)throw n;const d=a.map(c=>({id:c.id,date:new Date(`${c.scheduled_date}T${c.scheduled_time}`).toISOString(),peptide:c.peptide_name,dosage:c.dosage,unit:c.unit,time:c.scheduled_time.slice(0,5),completed:c.completed,notes:c.notes}));h(d)}catch(a){console.error("Error fetching schedules:",a),_()}finally{g(!1)}};return{schedules:i,loading:y,addSchedule:async a=>{const n={id:"temp-"+Date.now(),completed:!1,...a},d=[...i,n];if(h(d),l)try{const c=new Date(a.date),{data:o,error:f}=await v.from("schedules").insert([{user_id:l.id,peptide_name:a.peptide,dosage:a.dosage,unit:a.unit,scheduled_date:c.toISOString().split("T")[0],scheduled_time:a.time+":00",completed:!1,notes:a.notes||null}]).select().single();if(f)throw f;h(j=>j.map(t=>t.id===n.id?{...t,id:o.id}:t))}catch(c){console.error("Error adding schedule:",c),p()}else u(d)},deleteSchedule:async a=>{const n=i.filter(d=>d.id!==a);if(h(n),l)try{const{error:d}=await v.from("schedules").delete().eq("id",a);if(d)throw d}catch(d){console.error("Error deleting schedule:",d),p()}else u(n)},toggleComplete:async a=>{const n=i.find(o=>o.id===a);if(!n)return;const d=!n.completed,c=i.map(o=>o.id===a?{...o,completed:d}:o);if(h(c),l)try{const{error:o}=await v.from("schedules").update({completed:d}).eq("id",a);if(o)throw o}catch(o){console.error("Error toggling schedule:",o),p()}else u(c)}}},U="_container_ag7tr_1",K="_calendarCard_ag7tr_9",Y="_header_ag7tr_13",Q="_navBtn_ag7tr_26",V="_grid_ag7tr_44",X="_dayHeader_ag7tr_50",Z="_day_ag7tr_50",ee="_selected_ag7tr_75",te="_dimmed_ag7tr_81",se="_dots_ag7tr_86",ae="_dot_ag7tr_86",ce="_completedDot_ag7tr_99",de="_detailsSection_ag7tr_103",re="_detailsHeader_ag7tr_109",ne="_form_ag7tr_120",oe="_inputGroup_ag7tr_140",le="_row_ag7tr_162",ie="_scheduleList_ag7tr_168",he="_emptyText_ag7tr_174",ue="_scheduleItem_ag7tr_180",me="_completedItem_ag7tr_188",pe="_scheduleLeft_ag7tr_192",ge="_checkIcon_ag7tr_200",_e="_circleIcon_ag7tr_204",xe="_scheduleInfo_ag7tr_208",fe="_schedulePeptide_ag7tr_213",je="_scheduleDetails_ag7tr_218",Se="_deleteBtn_ag7tr_223",s={container:U,calendarCard:K,header:Y,navBtn:Q,grid:V,dayHeader:X,day:Z,selected:ee,dimmed:te,dots:se,dot:ae,completedDot:ce,detailsSection:de,detailsHeader:re,form:ne,inputGroup:oe,row:le,scheduleList:ie,emptyText:he,scheduleItem:ue,completedItem:me,scheduleLeft:pe,checkIcon:ge,circleIcon:_e,scheduleInfo:xe,schedulePeptide:fe,scheduleDetails:je,deleteBtn:Se},ve=()=>{const{schedules:i,addSchedule:h,deleteSchedule:y,toggleComplete:g}=J(),[l,_]=m.useState(new Date),[u,p]=m.useState(new Date),[N,x]=m.useState(!1),[r,a]=m.useState({peptide:"",dosage:"",unit:"mg",time:"08:00"}),n=E({start:L($(l)),end:T(O(l))}),d=()=>_(H(l,1)),c=()=>_(G(l)),o=t=>{p(t),x(!1)},f=t=>{t.preventDefault(),!(!r.peptide||!r.dosage)&&(h({date:u.toISOString(),peptide:r.peptide,dosage:parseFloat(r.dosage),unit:r.unit,time:r.time}),a({peptide:"",dosage:"",unit:"mg",time:"08:00"}),x(!1))},j=i.filter(t=>D(new Date(t.date),u));return e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:`card glass-panel ${s.calendarCard}`,children:[e.jsxs("div",{className:s.header,children:[e.jsx("button",{onClick:c,className:s.navBtn,children:e.jsx(F,{})}),e.jsx("h2",{children:I(l,"MMMM yyyy")}),e.jsx("button",{onClick:d,className:s.navBtn,children:e.jsx(z,{})})]}),e.jsxs("div",{className:s.grid,children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:s.dayHeader,children:t},t)),n.map(t=>{const C=i.filter(S=>D(new Date(S.date),t)),M=C.length>0,b=D(t,u),k=B(t,l);return e.jsxs("div",{className:`${s.day} ${k?"":s.dimmed} ${b?s.selected:""}`,onClick:()=>o(t),children:[e.jsx("span",{children:I(t,"d")}),M&&e.jsx("div",{className:s.dots,children:C.slice(0,3).map(S=>e.jsx("div",{className:`${s.dot} ${S.completed?s.completedDot:""}`},S.id))})]},t.toString())})]})]}),e.jsxs("div",{className:s.detailsSection,children:[e.jsxs("div",{className:s.detailsHeader,children:[e.jsx("h3",{children:I(u,"EEEE, MMMM do")}),e.jsxs("button",{className:"btn-primary",onClick:()=>x(!N),children:[e.jsx(q,{size:18})," Add Schedule"]})]}),N&&e.jsxs("form",{className:`card glass-panel ${s.form}`,onSubmit:f,children:[e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Peptide"}),e.jsx("input",{type:"text",value:r.peptide,onChange:t=>a({...r,peptide:t.target.value}),placeholder:"e.g. Tirzepatide",required:!0})]}),e.jsxs("div",{className:s.row,children:[e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Dosage"}),e.jsx("input",{type:"number",step:"0.01",value:r.dosage,onChange:t=>a({...r,dosage:t.target.value}),required:!0})]}),e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Unit"}),e.jsxs("select",{value:r.unit,onChange:t=>a({...r,unit:t.target.value}),children:[e.jsx("option",{value:"mg",children:"mg"}),e.jsx("option",{value:"mcg",children:"mcg"}),e.jsx("option",{value:"iu",children:"IU"})]})]})]}),e.jsxs("div",{className:s.inputGroup,children:[e.jsx("label",{children:"Time"}),e.jsx("input",{type:"time",value:r.time,onChange:t=>a({...r,time:t.target.value})})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",marginTop:"1rem"},children:"Save Schedule"})]}),e.jsx("div",{className:s.scheduleList,children:j.length===0?e.jsx("p",{className:s.emptyText,children:"No shots scheduled for this day."}):j.map(t=>e.jsxs("div",{className:`card ${s.scheduleItem} ${t.completed?s.completedItem:""}`,children:[e.jsxs("div",{className:s.scheduleLeft,onClick:()=>g(t.id),children:[t.completed?e.jsx(A,{className:s.checkIcon,size:24}):e.jsx(R,{className:s.circleIcon,size:24}),e.jsxs("div",{className:s.scheduleInfo,children:[e.jsx("span",{className:s.schedulePeptide,children:t.peptide}),e.jsxs("span",{className:s.scheduleDetails,children:[t.dosage,t.unit," at ",t.time]})]})]}),e.jsx("button",{className:s.deleteBtn,onClick:()=>y(t.id),children:e.jsx(W,{size:18})})]},t.id))})]})]})},Ie=()=>e.jsx("div",{className:"padding-container",style:{padding:"20px"},children:e.jsx(ve,{})});export{Ie as default};
